name: Update Documentation Date

on:
  push:
    paths:
      - 'DocumentationUCZONE.md'
    branches:
      - main

jobs:
  update-date:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Get Commit Date
        id: date
        run: |
          # Get the date of the last commit (HEAD)
          # Format: DD.MM.YYYY
          LAST_DATE=$(git show -s --format="%cd" --date=format:"%d.%m.%Y" HEAD)
          echo "NEW_DATE=$LAST_DATE" >> $GITHUB_ENV
          echo "Found date: $LAST_DATE"

      - name: Update Dates
        run: |
          # Update date in README.md (looks for "**Последнее обновление**: DD.MM.YYYY")
          sed -i "s/\*\*Последнее обновление\*\*: [0-9]\{2\}\.[0-9]\{2\}\.[0-9]\{4\}/**Последнее обновление**: $NEW_DATE/g" README.md
          
          # If the same pattern exists in DocumentationUCZONE.md, update it too
          if grep -q "\*\*Последнее обновление\*\*" DocumentationUCZONE.md; then
            sed -i "s/\*\*Последнее обновление\*\*: [0-9]\{2\}\.[0-9]\{2\}\.[0-9]\{4\}/**Последнее обновление**: $NEW_DATE/g" DocumentationUCZONE.md
          fi

      - name: Commit and Push changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "docs: update last updated date to ${{ env.NEW_DATE }} [skip ci]"
          file_pattern: "README.md DocumentationUCZONE.md"
